
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>
        #game-board {
            width: 450px;
            height: 450px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr;
            gap: 3px;
            background: #000;
            padding: 3px;
            margin: 0 auto;
        }

        .game-cell {
            background: white;
        }

        .small-board {
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr;
            gap: 1px;
        }

        .cell {
            border: 1px solid #888;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            cursor: pointer;
            background: white;
            font-family: Arial, Helvetica, sans-serif;
        }

        .cell:hover {
            background: #f0f0f0;
        }

        .small-board.active .cell {
            background: #fffacd;
        }
    </style>
</head>
<body>
    <div id="game-board">
        <div class="game-cell">
            <div class="small-board" data-board="0">
                <div class="cell" data-board="0" data-cell="0"></div>
                <div class="cell" data-board="0" data-cell="1"></div>
                <div class="cell" data-board="0" data-cell="2"></div>
                <div class="cell" data-board="0" data-cell="3"></div>
                <div class="cell" data-board="0" data-cell="4"></div>
                <div class="cell" data-board="0" data-cell="5"></div>
                <div class="cell" data-board="0" data-cell="6"></div>
                <div class="cell" data-board="0" data-cell="7"></div>
                <div class="cell" data-board="0" data-cell="8"></div>
            </div>
        </div>
        <div class="game-cell">
            <div class="small-board" data-board="1">
                <div class="cell" data-board="1" data-cell="0"></div>
                <div class="cell" data-board="1" data-cell="1"></div>
                <div class="cell" data-board="1" data-cell="2"></div>
                <div class="cell" data-board="1" data-cell="3"></div>
                <div class="cell" data-board="1" data-cell="4"></div>
                <div class="cell" data-board="1" data-cell="5"></div>
                <div class="cell" data-board="1" data-cell="6"></div>
                <div class="cell" data-board="1" data-cell="7"></div>
                <div class="cell" data-board="1" data-cell="8"></div>
            </div>
        </div>
        <div class="game-cell">
            <div class="small-board" data-board="2">
                <div class="cell" data-board="2" data-cell="0"></div>
                <div class="cell" data-board="2" data-cell="1"></div>
                <div class="cell" data-board="2" data-cell="2"></div>
                <div class="cell" data-board="2" data-cell="3"></div>
                <div class="cell" data-board="2" data-cell="4"></div>
                <div class="cell" data-board="2" data-cell="5"></div>
                <div class="cell" data-board="2" data-cell="6"></div>
                <div class="cell" data-board="2" data-cell="7"></div>
                <div class="cell" data-board="2" data-cell="8"></div>
            </div>
        </div>
        <div class="game-cell">
            <div class="small-board" data-board="3">
                <div class="cell" data-board="3" data-cell="0"></div>
                <div class="cell" data-board="3" data-cell="1"></div>
                <div class="cell" data-board="3" data-cell="2"></div>
                <div class="cell" data-board="3" data-cell="3"></div>
                <div class="cell" data-board="3" data-cell="4"></div>
                <div class="cell" data-board="3" data-cell="5"></div>
                <div class="cell" data-board="3" data-cell="6"></div>
                <div class="cell" data-board="3" data-cell="7"></div>
                <div class="cell" data-board="3" data-cell="8"></div>
            </div>
        </div>
        <div class="game-cell">
            <div class="small-board" data-board="4">
                <div class="cell" data-board="4" data-cell="0"></div>
                <div class="cell" data-board="4" data-cell="1"></div>
                <div class="cell" data-board="4" data-cell="2"></div>
                <div class="cell" data-board="4" data-cell="3"></div>
                <div class="cell" data-board="4" data-cell="4"></div>
                <div class="cell" data-board="4" data-cell="5"></div>
                <div class="cell" data-board="4" data-cell="6"></div>
                <div class="cell" data-board="4" data-cell="7"></div>
                <div class="cell" data-board="4" data-cell="8"></div>
            </div>
        </div>
        <div class="game-cell">
            <div class="small-board" data-board="5">
                <div class="cell" data-board="5" data-cell="0"></div>
                <div class="cell" data-board="5" data-cell="1"></div>
                <div class="cell" data-board="5" data-cell="2"></div>
                <div class="cell" data-board="5" data-cell="3"></div>
                <div class="cell" data-board="5" data-cell="4"></div>
                <div class="cell" data-board="5" data-cell="5"></div>
                <div class="cell" data-board="5" data-cell="6"></div>
                <div class="cell" data-board="5" data-cell="7"></div>
                <div class="cell" data-board="5" data-cell="8"></div>
            </div>
        </div>
        <div class="game-cell">
            <div class="small-board" data-board="6">
                <div class="cell" data-board="6" data-cell="0"></div>
                <div class="cell" data-board="6" data-cell="1"></div>
                <div class="cell" data-board="6" data-cell="2"></div>
                <div class="cell" data-board="6" data-cell="3"></div>
                <div class="cell" data-board="6" data-cell="4"></div>
                <div class="cell" data-board="6" data-cell="5"></div>
                <div class="cell" data-board="6" data-cell="6"></div>
                <div class="cell" data-board="6" data-cell="7"></div>
                <div class="cell" data-board="6" data-cell="8"></div>
            </div>
        </div>
        <div class="game-cell">
            <div class="small-board" data-board="7">
                <div class="cell" data-board="7" data-cell="0"></div>
                <div class="cell" data-board="7" data-cell="1"></div>
                <div class="cell" data-board="7" data-cell="2"></div>
                <div class="cell" data-board="7" data-cell="3"></div>
                <div class="cell" data-board="7" data-cell="4"></div>
                <div class="cell" data-board="7" data-cell="5"></div>
                <div class="cell" data-board="7" data-cell="6"></div>
                <div class="cell" data-board="7" data-cell="7"></div>
                <div class="cell" data-board="7" data-cell="8"></div>
            </div>
        </div>
        <div class="game-cell">
            <div class="small-board" data-board="8">
                <div class="cell" data-board="8" data-cell="0"></div>
                <div class="cell" data-board="8" data-cell="1"></div>
                <div class="cell" data-board="8" data-cell="2"></div>
                <div class="cell" data-board="8" data-cell="3"></div>
                <div class="cell" data-board="8" data-cell="4"></div>
                <div class="cell" data-board="8" data-cell="5"></div>
                <div class="cell" data-board="8" data-cell="6"></div>
                <div class="cell" data-board="8" data-cell="7"></div>
                <div class="cell" data-board="8" data-cell="8"></div>
            </div>
        </div>
    </div>


    <script>
        var gameState = [
    ["","",""],
    ["","",""],
    ["","",""]
];
var gameFinished = false;
var playerTurn = true;
var aiTurn = true;

var numOfWhites = [];
var numOfBlacks = [];


var board = document.getElementById("board");
board.addEventListener('click', playerPlay);

aiPlay();
function playerPlay(ev){
    if(playerTurn){
        if(ev.target.textContent == ""){
            ev.target.textContent = "X";
            var x = ev.target.id[0];
            var y = ev.target.id[1]
            gameState[x][y] = "X";

            ////////remove for normal tictactoe
            // if(numOfWhites.length >=3){
            //     gameState[numOfWhites[0].x][numOfWhites[0].y]="";
            //     document.getElementById(""+numOfWhites[0].x+numOfWhites[0].y).textContent="";
            //     numOfWhites.splice(0,1);
            // }
            // numOfWhites.push({x,y});

            /////////////////////////////////////////////
        }
        if(checkPlayerWin("X")){
            setTimeout(()=>{
                alert("player win")
                return;
            },1000);
        }else if(catsgame()){
            setTimeout(()=>{
                alert("catsgame")
            return;
            },1000);
            
        }
        else{
            setTimeout(()=>{
                aiPlay();
            },1000);
        }
    }
}

function aiPlay(){
    console.log("hi")
    var bestScore = -1000;
    var bestMove;
        for(var x = 0;x<3;x++){
            for(var i=0;i<3;i++){
                if(gameState[x][i] ==""){
                    gameState[x][i] = "O";
                    let score = minmax(gameState, false);
                    gameState[x][i] = "";
                    if(score>bestScore){
                        bestScore=score;
                        bestMove = {x,i};
                    }
                }
            }
        }
        gameState[bestMove.x][bestMove.i] = "O";
        document.getElementById(""+bestMove.x+bestMove.i).textContent = "O";

        //////remove for normal tic tac toe
        // numOfBlacks.push(bestMove);

        // if(numOfBlacks.length >=4){
        //     gameState[numOfBlacks[0].x][numOfBlacks[0].i]="";
        //     document.getElementById(""+numOfBlacks[0].x+numOfBlacks[0].i).textContent="";
        //     numOfBlacks.splice(0,1);
        // }
        /////////////////////////////////////////////////

        if(checkPlayerWin("O")){
            setTimeout(()=>{
                alert("ai wins");
            },1000)
        }
        if(catsgame()){
            setTimeout(()=>{
                alert("catsgame")
            },1000)
        }
}

function minmax(board, aiTurn){
    if(checkPlayerWin("O")){
        return 1;
    }
    else if(checkPlayerWin("X")){
        return -1;
    }
    else if (catsgame()){
        return 0;
    }

    if(aiTurn){
        var bestScore = -1000;
        for(var x = 0;x<3;x++){
            for(var i=0;i<3;i++){
                if(board[x][i] ==""){
                    board[x][i] = "O";
                    let score = minmax(board, false);
                    board[x][i] = "";
                    if(score>bestScore){
                        bestScore=score;
                    }
                }
            }
        }
        return bestScore;
    }
    else{
        var bestScore = 1000;
        for(var x = 0;x<3;x++){
            for(var i=0;i<3;i++){
                if(board[x][i] ==""){
                    board[x][i] = "X";
                    let score = minmax(board, true);
                    board[x][i] = "";
                    if(score<bestScore){
                        bestScore=score;
                    }
                }
            }
        }
        return bestScore;
    }
}

function checkPlayerWin(player){
    for (let i = 0; i < 3; i++) {
        if (
            gameState[i][0] === player && gameState[i][1] === player && gameState[i][2] === player || // Row check
            gameState[0][i] === player && gameState[1][i] === player && gameState[2][i] === player   // Column check
        ) {
            return true;
        }
    }
    if (
        gameState[0][0] === player && gameState[1][1] === player && gameState[2][2] === player || // Main diagonal
        gameState[0][2] === player && gameState[1][1] === player && gameState[2][0] === player   // Anti-diagonal
    ) {
        return true;
    }

    return false;
}

function catsgame(){
    for(var x = 0;x<3;x++){
        for(var i = 0;i<3;i++){
            if(gameState[x][i]==""){
                return false;
            }
        }
    }
    return true;
}


    </script>
</body>
</html>